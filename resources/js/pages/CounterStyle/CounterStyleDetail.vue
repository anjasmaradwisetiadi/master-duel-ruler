<template>
    <div id="CounterStyleDetail" class="mt-4">
        <div class="row justify-content-center mb-5">
            <div class="col-8 text-center">
                <h1>{{ getDataCounterStyleDeck?.title?.toUpperCase() }}</h1>
            </div>
        </div>
        <div class="row mb-2">
            <div class="col">
                <button type="button" class="btn btn-success mr-2" @click="editCounterStyle(getDataCounterStyleDeck.slug)">Edit Counter Style</button>
                <button type="button" class="btn btn-danger" @click="deleteCounterStyle()">Delete Counter Style</button>
            </div>
            <div class="col d-flex justify-content-end">
                <button type="button" class="btn btn-warning" @click="backRoute()">Back</button>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <h5>Information: </h5>
                <div class="card">
                    <div class="card-body" >
                        <div class="information-html" v-html="getDataCounterStyleDeck.information"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- list image previews -->
        <ListImageHover :getDataYgoProDeck='getDataYgoProDeck' @dataModalCard='dataModalCard' ></ListImageHover>

        <!-- modal image previews -->
        <ImagePreview :openModal="openModal" :dataSelectCards="dataSelectCards" @dataModalCardPreview="dataModalCardPreview"></ImagePreview>
        <LoadingAndAlert :loading="loading" :confirmDelete="confirmDelete" @confirm="methodConfirmDelete" ></LoadingAndAlert>
    </div>
</template>

<script setup>

import { computed, onMounted, ref, reactive, watch } from 'vue';
import LoadingAndAlert from '../../components/LoadingAndAlert.vue';
import ListImageHover from '../../components/ListImageHover.vue';
import ImagePreview from '../../components/ImagePreview.vue'
import { useRouter } from 'vue-router';
import { useStore } from 'vuex';
import Swal from 'sweetalert2';
const router = useRouter();
const store = useStore();

const urlDataImages = ref(store.state.dataListChips);

const openModal = ref(false);
const dataSelectCards = ref();
const paramsUrl = ref('');
const confirmDelete = ref(false);
const statusDelete = ref(false);

const state = reactive({
    paramsUrl,
    confirmDelete,
    statusDelete
}) 

onMounted(()=>{
    const payload = router.currentRoute.value.params.slug
    state.paramsUrl = payload;
    store.dispatch('detailCounterStyle', payload);
})
const getDataCounterStyleDeck= computed(()=>{
    return store.state.detailCounterStyle;
})


const loading = computed(()=>{
    return store.getters.getterStateLoading;
})

const responseGeneral = computed(()=>{
    return store.state.responseGeneral
})

const getDataYgoProDeck = computed(()=>{
    return store.state.dataListChips;
})


watch(getDataCounterStyleDeck, async (newValue, oldValue)=>{
    const dataListChips= newValue.list_chips;
    store.state.dataListChips = [];
    for (let dataListChip of dataListChips) {
        if(dataListChip.includes('&')){
            dataListChip = dataListChip.replaceAll('&','%26')
        }
        store.dispatch("getDataListChips",dataListChip);
    }
})

function dataModalCardPreview (value) {
    openModal.value = value;
}

// it cannot use watch whe we want get data ready
// const watchResponseGeneral = store.watch( (state, getters) => state.responseGeneral, (newValue, oldValue)=>{
//         state.statusDelete = newValue.status;
// })

function dataModalCard($event){
    dataSelectCards.value = $event.dataSelectCards;
    openModal.value = $event.openModal;
}

function editCounterStyle(slug){
    router.push(`/counter-style-deck/${slug}/edit`);
}

function deleteCounterStyle(){
    state.confirmDelete = true;
}

function methodConfirmDelete($event){
    if($event){
        Swal.fire({
            title: "Success Delete ",
            icon: "success"
        })
        .then((success)=>{
            if(success){
                store.dispatch('deleteCounterStyle', paramsUrl.value);
                router.push('/counter-style-deck/');
            }
        });
        
        // it still not working
        // dataDelete.then((result)=>{
        //     console.log("result = ")
        //     console.log(result)
        //     if(result.status){
        //         Swal.fire({
        //             title: "Success Delete ",
        //             icon: "success"
        //         })
        //         .then((success)=>{
        //             if(success){
        //                 router.push('/counter-style-deck/');
        //             }
        //     });
        //     }
        // })
        // router.push('/counter-style-deck/');
        // console.log("statusDelete.value = ");
        // console.log(statusDelete.value);
        // still blocking for implement this code

    }
}

function backRoute(){
    router.back();
}

</script>
<style scoped>
    .card{
        color: black;
    }
    .card-style {
        border: 2px solid #03182c;
        max-height: 84px;
    }
    .image-crop-resize{
        max-width: 82px;
        max-height: 80px;
        border: 2px solid black;
    }
    h4{
        font-weight: 600 !important;
        padding: 0px !important;
        margin: 0px !important;
    }
    .date-update{
        font-size: 14px;
    }

</style>

<style>
    .card-body .information-html p{
        padding: 0px !important;
        margin: 0px !important;
    }
</style>